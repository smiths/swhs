\documentclass[12pt]{article}

\usepackage{bm}
\usepackage{amsmath, mathtools}

\usepackage[round]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
%\usepackage{fullpage}

\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

%% Comments
\newif\ifcomments\commentstrue

\ifcomments
\newcommand{\authornote}[3]{\textcolor{#1}{[#3 ---#2]}}
\newcommand{\todo}[1]{\textcolor{red}{[TODO: #1]}}
\else
\newcommand{\authornote}[3]{}
\newcommand{\todo}[1]{}
\fi

\newcommand{\wss}[1]{\authornote{blue}{SS}{#1}}
\newcommand{\bmac}[1]{\authornote{red}{BM}{#1}}

\newcommand{\progname}{SWHS}

\begin{document}

\title{Module Interface Specification for Solar Water Heating Systems
  Incorporating Phase Change Material}

\author{Brooks MacLachlan and Spencer Smith}

\date{\today}

\maketitle

\tableofcontents

\section{Introduction}

The following document details the Module Interface Specifications for the
implemented modules in a program simulating a Solar Water Heating System with
Phase Change Material.  It is intended to ease navigation through the program
for design and maintenance purposes.

Complementary documents include the System Requirement Specifications and Module
Guide.

\section{Notation}

The structure of the MIS for modules comes from \citet{HoffmanAndStrooper1995},
with the addition that template modules have been adapted from
\cite{GhezziEtAl2003}.  The mathematical notation comes from Chapter 3 of
\citet{HoffmanAndStrooper1995}.  For instance, the symbol := is used for a
multiple assignment statement and conditional rules follow the form $(c_1
\Rightarrow r_1 | c_2 \Rightarrow r_2 | ... | c_n \Rightarrow r_n )$.

The following table summarizes the primitive data types used by \progname. 

\begin{center}
\renewcommand{\arraystretch}{1.2}
\noindent 
\begin{tabular}{c c c} 
\toprule 
\textbf{Data Type} & \textbf{Notation} & \textbf{Description}\\ 
\midrule
character & char & a single symbol or digit\\
integer & $\mathbb{Z}$ & a number without a fractional component in (-$\infty$, $\infty$) \\
natural number & $\mathbb{N}$ & a number without a fractional component in [1, $\infty$) \\
real & $\mathbb{R}$ & any number in (-$\infty$, $\infty$)\\
\bottomrule
\end{tabular} 
\end{center}

\noindent
The specification of \progname \ uses some derived data types: sequences, strings, and
tuples. Sequences are lists filled with elements of the same data type. Strings
are sequences of characters. Tuples contain a list of values, potentially of
different types. In addition, \progname \ uses functions, which
are defined by the data types of their inputs and outputs. Functions are
described by showing their input data types separated by multiplication symbols
on the left side of an arrow, and their output data type on the right side.

\section{Module Decomposition}

The following table is taken directly from the Module Guide document for this project.

\begin{table}[!h]
	\centering
	\begin{tabular}{p{0.3\textwidth} p{0.6\textwidth}}
		\toprule
		\textbf{Level 1} & \textbf{Level 2}\\
		\midrule
		
		{Hardware-Hiding Module} & ~ \\
		\midrule
		
		\multirow{7}{0.3\textwidth}{Behaviour-Hiding Module} & Input Format Module\\
		& Input Parameters Module\\
		& Input Verification Module\\
		& Output Format Module\\
		& Output Verification Module\\
		& Temperature ODEs Module\\
		& Energy Equations Module\\ 
		& Control Module\\
		\midrule
		
		\multirow{3}{0.3\textwidth}{Software Decision Module} & {Sequence Data Structure Module}\\
		& ODE Solver Module\\
		& Plotting Module\\
		\bottomrule
		
	\end{tabular}
	\caption{Module Hierarchy}
	\label{TblMH}
\end{table}

\newpage
~\newpage
\section{MIS of Control Module} \label{Main}

\subsection{Module}

main

\subsection{Uses}

parameters (Section~\ref{Parameters}), load\_params (Section~\ref{Load}), verify\_params
(Section~\ref{VerifyInput}), temperature (Section~\ref{Temperature}), ODE Solvers Module
(Section~\ref{ODE}), energy (Section~\ref{Energy}), verify\_output (Section~\ref{VerifyOutput}), plot
(Section~\ref{Plot}), output (Section~\ref{Output})

\subsection{Syntax}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
main & string & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

$time$: array of $\mathbb{R}$ \\
$tempW$: array of $\mathbb{R}$ \\
$tempP$: array of $\mathbb{R}$ \\
$latHeat$: array of $\mathbb{R}$ \\
$eW$: array of $\mathbb{R}$ \\
$eP$: array of $\mathbb{R}$ \\ 
$eTot$: array of $\mathbb{R}$

\subsubsection{Environment Variables}

$win$: 2D array of pixels displayed on the screen

\subsubsection{Access Routine Semantics}

\begin{tabular}{l l p{12cm}}
main($s$): & transition: & $time$, $tempW$, $tempP$, $latHeat$, $eW$, $eP$,
                           $eTot$, $win :=$ $results$[0], $results$[1],
                           $results$[2], $results$[3], $eW1 \| eW2 \| eW3$, $eP1
                           \| eP2 \| eP3$, ($\forall i \in$ [0..$|post$($eW$)$|
                           - 1$]) ($post$($eW$[$i$]) $+$ $post$($eP$[$i$])),
                           Prints information about the melting of PCM. \\
& exception: & none \\
\end{tabular}

\newpage
\section{MIS of Input Parameters Module} \label{Parameters}

\subsection{Module}

Param

\subsection{Uses}

N/A

\subsection{Syntax}

\begin{tabular}{c c c c}
\toprule
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\midrule
load\_params & string & - &  - \\
$L$ & - & $\mathbb{R}$\\
$D$ & - & $\mathbb{R}$\\
$V_P$ & - & $\mathbb{R}$\\
$A_P$ & - & $\mathbb{R}$\\
... & - & ...\\
\bottomrule
\end{tabular}

\subsection{Semantics}

\subsubsection{Environment Variables}

f: sequence of string \#\textit{f[i] is the ith string in the text file f}\\ 

\subsubsection{State Variables}

L: $\mathbb{R}$ \\
diam: $\mathbb{R}$ \\
Vp: $\mathbb{R}$ \\
Ap: $\mathbb{R}$ \\
rho\_p: $\mathbb{R}$ \\
Tmelt: $\mathbb{R}$ \\
C\_ps: $\mathbb{R}$ \\
C\_pl: $\mathbb{R}$ \\
Hf: $\mathbb{R}$ \\
Ac: $\mathbb{R}$ \\
Tc: $\mathbb{R}$ \\
rho\_w: $\mathbb{R}$ \\
C\_w: $\mathbb{R}$ \\
hc: $\mathbb{R}$ \\
hp: $\mathbb{R}$ \\
Tinit: $\mathbb{R}$ \\
tstep: $\mathbb{R}$ \\
tfinal: $\mathbb{R}$ \\
AbsTol: $\mathbb{R}$ \\
RelTol: $\mathbb{R}$ \\
ConsTol: $\mathbb{R}$ \\
Vt: $\mathbb{R}$ \\
Mw: $\mathbb{R}$ \\
tau\_w: $\mathbb{R}$ \\
eta: $\mathbb{R}$ \\
Mp: $\mathbb{R}$ \\
tau\_ps: $\mathbb{R}$ \\
tau\_pl: $\mathbb{R}$ \\
Epmelt\_init: $\mathbb{R}$ \\
Ep\_melt3: $\mathbb{R}$ \\ 
Mw\_noPCM: $\mathbb{R}$ \\
tau\_w\_no\_PCM: $\mathbb{R}$

\subsubsection{Assumptions}

load\_params will be called before the values of any state variables will be accessed.

\subsubsection{Access Routine Semantics}

\noindent init():
\begin{itemize}
\item transition: L, diam,  Vp, Ap, ..., tau\_w\_no\_PCM := 0, 0, 0, 0, ..., 0
\item output: \textit{out} := self
\item exception: none
\end{itemize}

\noindent getL():
\begin{itemize}
\item output: \textit{out} := L
\item exception: none
\end{itemize}

\noindent get\_diam():
\begin{itemize}
\item output: \textit{out} := diam
\item exception: none
\end{itemize}

\noindent getVp():
\begin{itemize}
\item output: \textit{out} := Vp
\item exception: none
\end{itemize}

\noindent getAp():
\begin{itemize}
\item output: \textit{out} := Ap
\item exception: none
\end{itemize}

...

\noindent get\_tau\_w\_no\_PCM():
\begin{itemize}
\item output: \textit{out} := tau\_w\_no\_PCM
\item exception: none
\end{itemize}

\noindent setL(x):
\begin{itemize}
\item transition: L := x
\item exception: none
\end{itemize}

\noindent set\_diam(x):
\begin{itemize}
\item transition: diam := x
\item exception: none
\end{itemize}

\noindent setVp(x):
\begin{itemize}
\item transition: Vp := x
\item exception: none
\end{itemize}

\noindent setAp(x):
\begin{itemize}
\item transition: Ap := x
\item exception: none
\end{itemize}

...

\noindent set\_tau\_w\_no\_PCM(x):
\begin{itemize}
\item transition: tau\_w\_no\_PCM := x
\item exception: none
\end{itemize}

\subsection{Considerations}

The value of each state variable can be accessed through its name (getter).  An
access program is available for each state variable.  There are no setters for
the state variables, since the values will be set and checked by load params and
not changed for the life of the program.

\newpage

\section{MIS of Input Format Module} \label{Load}

\subsection{Module}

Load\_params

\subsection{Uses}

Param (Section~\ref{Parameters})

\subsection{Syntax}

\subsection{Exported Access Programs}

\begin{center}
\begin{tabular}{c c c c}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
load\_params & string & - &  - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{Environment Variables}

f: sequence of string \#\textit{f[i] is the ith string in the text file f}\\ 

\subsubsection{Assumptions}

The input string corresponds to an existing filename.  The name will be relative
to the current directory. The input file is assumed to be formatted
correctly. The file contains the string equivalents of the numeric values for
each input parameter in order, each on a new line. The order is the same as in
the table in R1 of the SRS. Any comments in the input file should be denoted
with a '\#' symbol.

\subsubsection{Access Routine Semantics}

load\_params($s$):
\begin{itemize}
\item transition: The filename $s$ is first associated with the file f.
  File $f$ is then used to modify the state of Param (Section~\ref{Parameters}) as
  follows:
\begin{enumerate}
\item Param.init()
\item Read data sequentially from f to populate the state variables of
  Param from L to ConsTol.
\item Calculate the derived quantities in Param as follows:
\begin{itemize}
\item Param.setVt(calcVt(Param.getL(), Param.get\_diam()))
\item Param.setMw(calcMw(Param.getVp(), Param.get\_rho\_w(), Param.getVt()))
\item Param.set\_tau\_w(calcTauw(Param.getMw(), Param.getC\_w(), Param.get\_hc(), Param.getAc()))
\item Param.set\_eta(calcEta(Param.get\_hp(), Param.getAp(), Param.get\_hc(), Param.getAc()))
\item Param.setMp(calcMp(Param.get\_rho\_p(), Param.getVp()))
\item Param.set\_tau\_ps(calcTaups(Param.getMp(), Param.getC\_ps(),
  Param.get\_hp(), Param.getAp()))
\item Param.set\_taul\_pl(calcTaupl(Param.getMp(), Param.getC\_pl(),
  Param.get\_hp(), Param.getAp()))
\item Param.setEpmelt\_init(calcEpmeltinit(Param.getC\_ps(), Param.getMp(),
  Param.getTmelt(), Param.getTinit()))
\item Param.setEp\_melt3(calcEpmelt3(Param.getHf(), Param.getMp()))
\item Param.setMw\_noPCM(calcMwno(Param.get\_rho\_w, Param.getVt()))
\item Param.set\_tau\_no\_PCM(calcTauwnoPCM(Param.getMw\_noPCM(),
  Param.getC\_w(), Param.get\_hc(), Param.getAc()))
\end{itemize}
\end{enumerate}

\item exception: none
\end{itemize}

\subsubsection{Local Functions}

calcVt: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcVt($L$, $d$) $\equiv$ $\pi \times L \times (\frac{d}{2}) ^ 2$ \\
\newline
calcMw: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcMw($V_p$, $\rho_w$, $V_t$) $\equiv$ $\rho_w (V_t - V_p)$ \\
\newline
calcTauw: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcTauw($m_w$, $C_w$, $h_c$, $A_c$) $\equiv$ $\frac{m_w C_w}{A_c h_c}$ \\
\newline
calcEta: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcEta($h_p$, $A_p$, $h_c$, $A_c$) $\equiv$ $\frac{h_p A_p}{h_c A_c}$ \\
\newline
calcMp: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcMp($\rho_p$, $V_p$) $\equiv$ $\rho_p V_p$ \\
\newline
calcTaups: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcTaups($M_p$, $C_{ps}$, $h_p$, $A_p$) $\equiv$ $\frac{M_p C_{ps}}{h_p A_p}$ \\
\newline
calcTaupl: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcTaupl($M_p$, $C_{pl}$, $h_p$, $A_p$) $\equiv$ $\frac{M_p C_{pl}}{h_p A_p}$ \\
\newline
calcEpmeltinit: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcEpmeltinit($C_{ps}$, $M_p$, $T_{\text{melt}}$, $T_{\text{init}}$) $\equiv$ $C_{ps} M_p (T_{\text{melt}} - T_{\text{init}})$ \\
\newline
calcEpmelt3: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcEpmelt3($H_f$, $M_p$) $\equiv$ $H_f M_p$ \\
\newline
calcMwnoPCM: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcMwnoPCM($\rho_w$, $V_t$) $\equiv$ $\rho_w  V_t$ \\
\newline
calcTauwnoPCM: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
calcTauwnoPCM(${M_w}_{\text{noPCM}}$, $C_w$, $h_c$, $A_c$) $\equiv$
$\frac{{M_w}_{\text{noPCM}} C_w}{h_c A_c}$ \\

\newpage
\section{MIS of Input Verification Module} \label{VerifyInput}

\subsection{Module}

verify\_params

\subsection{Uses}

Param (Section~\ref{Parameters})

\subsection{Syntax}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{3cm} p{1cm} p{1cm} p{9cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
verify\_valid & - & - & badLength, badDiam, badPCMVolume, badPCMAndTankVol,
                        badPCMArea, badPCMDensity, badMeltTemp,
                        badCoilAndInitTemp, badCoilTemp, badPCMHeatCapSolid,
                        badPCMHeatCapLiquid, badHeatFusion, badCoilArea,
                        badWaterDensity, badWaterHeatCap, badCoilCoeff,
                        badPCMCoeff, badInitTemp, badFinalTime,
                        badInitAndMeltTemp \\
\hline
verify\_recommend & - & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

% \subsubsection{Environment Variables}

% $win$: 2D array of pixels displayed on the screen.

\subsubsection{Assumptions}

All of the fields Param have been assigned values before any of the access
routines for this module are called.

\subsubsection{Access Routine Semantics}

verify\_valid(): 
\begin{itemize}
\item transition: none
\item exceptions: exc := (\\
Param.getL() $\leq 0 \Rightarrow$ badLength $|$\\
Param.get\_diam() $\leq 0 \Rightarrow$ badDiam $|$\\
Params.get\_Vp() $\leq 0 \Rightarrow$ badPCMVolume $|$\\
Params.getVp() $\geq$ Params.Vt $\Rightarrow$ badPCMAndTankVol $|$\\
Params.getAp() $\leq 0 \Rightarrow$ badPCMArea $|$\\
Params.get\_rho\_p() $\leq 0 \Rightarrow$ badPCMDensity $|$\\
Params.getTmelt() $\leq 0 \Rightarrow$ badMeltTemp $|$\\
Params.getTmelt() $\geq$ Params.getTc() $\Rightarrow$ badMeltTemp $|$\\
Params.getTc() $\leq$ Params.getTinit() $\Rightarrow$ badCoilAndInitTemp $|$\\
Params.getTc() $\geq 100 \lor$ Params.getTc() $\leq 0 \Rightarrow$ badCoilTemp $|$\\
Params.getC\_ps() $\leq 0 \Rightarrow$ badPCMHeatCapSolid $|$\\
Params.getC\_pl() $\leq 0 \Rightarrow$ badPCMHeatCapLiquid $|$\\
Params.getHf() $\leq 0 \Rightarrow$ badHeatFusion $|$\\
Params.getAc() $\leq 0 \Rightarrow$ badCoilArea $|$\\
Params.get\_rho()\_w $\leq 0 \Rightarrow$ badWaterDensity $|$\\
Params.getC\_w() $\leq 0 \Rightarrow$ badWaterHeatCap $|$\\
Params.get\_hc() $\leq 0 \Rightarrow$ badCoilCoeff $|$\\
Params.get\_hp() $\leq 0 \Rightarrow$ badPCMCoeff $|$\\
Params.getTinit() $\leq 0 \lor$ Params.getTinit() $\geq 100 \Rightarrow$
badInitTemp $|$\\
Params.get\_tfinal() $\leq 0 \Rightarrow$ badFinalTime $|$\\
Params.getTinit() $\geq$ Params.getTmelt() $\Rightarrow$ badInitAndMeltTemp)  
\end{itemize}

verify\_recommend():
\begin{itemize}
\item transition: none
\item exceptions: exc := (\\
Params.getL() $< 0.1 \lor$ Params.getL() $> 50 \Rightarrow$ warnLength $|$\\
Params.getdiam() / Params.getL() $< 0.002 \lor$ Params.getdiam() / Params.getL() $> 200
\Rightarrow$ warnDiam $|$\\
Params.getVp() $<$ Params.getVt() $\times 10 ^ -6 \Rightarrow$ warnPCMVol $|$\\
Params.getVp() $>$ Params.getAp() $\lor$ Params.getAp $> (2/0.001) \times$ Params.getVp()
$\Rightarrow$ warnVolArea $|$\\
(Params.get\_rho\_p() $\leq 500) \lor ($ Params.get\_rho\_p() $\geq 20000) \Rightarrow$
warnPCMDensity $|$ ... )\\
\# \textit{Need to continue for the rest of the example - tabular form?}
\# \textit{Should add a module (Configuration Module) to store symbolic constants}
 % Params.getC\_ps \leq 100 \lor Params.getC\_ps \geq 4000 \Rightarrow$
 % warnPCMHeatCapSolid $|$\\
 % Params.getC\_pl \leq 100 \lor Params.getC\_pl \geq 5000 \Rightarrow$
 % warnPCMHeatCapLiquid $|$\\
 % Params.getAc > \pi \times (Params.getdiam / 2) ^ 2 \Rightarrow$ warnCoilArea
 % $|$\\
 % Params.getrho\_w \leq 950 \lor Params.getrho\_w > 1000 \Rightarrow$
 % warnWaterDensity $|$\\
 % Params.getC\_w \leq 4170 \lor Params.getC\_w \geq 4210 \Rightarrow$
 % warnWaterHeatCap $|$\\
 % Params.gethc \leq 10 \lor Params.gethc \geq 10000 \Rightarrow$ warnCoilCoeff $|$\\
 % Params.gethp \leq 10 \lor Params.gethp \geq 10000 \Rightarrow$ warnPCMCoeff $|$\\
 % Params.gettfinal \leq 0 \lor Params.gettfinal \geq 86400 \Rightarrow$ warnFinalTime)
\end{itemize}

\subsection{Considerations}

See Appendix (Section~\ref{Appendix}) for the complete list of exceptions and
associated error messages.

\newpage
\section{MIS of Temperature ODEs Module} \label{Temperature}

\subsection{Module}

temperature

\subsection{Uses}

Param (Section~\ref{Parameters})

\subsection{Syntax}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{3cm} p{5cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
temperature1 & $\mathbb{R}$, $\mathbb{R}$, $\mathbb{R}$ & sequence[2] of $\mathbb{R}$ & - \\
\hline
temperature2 & $\mathbb{R}$, $\mathbb{R}$, $\mathbb{R}$ & sequence[3] of $\mathbb{R}$ & - \\
\hline
temperature3 & $\mathbb{R}$, $\mathbb{R}$, $\mathbb{R}$ & sequence[2] of $\mathbb{R}$ & - \\
\hline
event1 & array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, parameters & function & - \\
\hline
event2 & array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, parameters & function & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

none

\subsubsection{Assumptions}

none

\subsubsection{Access Routine Semantics}

temperature1($Tw1$, $Tp1$, $t$, ): 
\begin{itemize}
\item output: $out :=$ dTdt(1)   =   (1/Params.get\_tau\_w())*((Params.getTc() - Tw1) +
  Params.getEta()*(Tp1 - Tw1));
\item exception: none
\end{itemize}
% temperature2($t$, $Tw2$, $Tp2$, $Qp2$, $params$): & output: & $out :=$ \{$dTw: \mathbb{R} \times \mathbb{R} \times \mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}$, $dTp: \mathbb{R} \times \mathbb{R} \times \mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}$, $dQp: \mathbb{R} \times \mathbb{R} \times \mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}$\} \\
% & exception: & none \\ \\
% temperature3($t$, $Tw3$, $Tp3$, $params$): & output: & $out :=$ \{$dTw: \mathbb{R} \times \mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}$, $dTp: \mathbb{R} \times \mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}$\} \\
% & exception: & none \\ \\
% event1($t$, $Tw1$, $Tp1$, $params$): & output: & $out :=$ $Ev: \mathbb{R} \times \mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}$ \\ 
% & exception: & none \\ \\
% event2($t$, $Tw2$, $T2p$, $Qp2$, $params$): & output: & $out :=$ $Ev: \mathbb{R} \times \mathbb{R} \times \mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}$ \\
% & exception: & none \\

\newpage
\section{MIS of ODE Solver Module} \label{ODE}

\subsection{Module}

ODE Solver Module

\subsection{Uses}

N/A

\subsection{Syntax}

\subsubsection{Exported Constants}

$MaxStep$: natural number \\
$N$: natural number

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
solve & function, array of $\mathbb{R}$, array of $\mathbb{R}$, function, $\mathbb{R}$, $\mathbb{R}$ & array of $\mathbb{R}$ ($N$ of them) & ODE\_BAD\_INPUT, ODE\_MAXSTEP, ODE\_ACCURACY \\
\hline 
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

$results$: array of $\mathbb{R}$ ($N$ of them)

\subsubsection{Access Routine Semantics}

\begin{center}
\begin{tabular}{l l p{5cm}}
solve($f$, $domain$, $ics$, $events$, $abstol$, $reltol$) & output: & $out := results$, where $results$ holds the solution to the ODE system generated by the solver. \\
& exceptions: & $exc :=$ (Invalid input parameters $\Rightarrow$ ODE\_BAD\_INPUT $|$ $MaxStep$ steps taken and no solution found $\Rightarrow$ ODE\_MAXSTEP $|$ $reltol$ and $abstol$ not satisfied for a step $\Rightarrow$ ODE\_ACCURACY)  \\
\end{tabular}
\end{center}

\newpage
\section{MIS of Energy Module} \label{Energy}

\subsection{Module}

energy

\subsection{Uses}

Param (Section~\ref{Parameters})

\subsection{Syntax}

\subsubsection{External Access Programs}

\begin{center}
\begin{tabular}{p{3cm} p{6cm} p{3cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
energy1Wat & array of $\mathbb{R}$, parameters & array of $\mathbb{R}$ & - \\
\hline
energy1PCM & array of $\mathbb{R}$, parameters & array of $\mathbb{R}$ & - \\
\hline
energy2Wat & array of $\mathbb{R}$, parameters & array of $\mathbb{R}$ & - \\
\hline
energy2PCM & array of $\mathbb{R}$, parameters & array of $\mathbb{R}$ & - \\
\hline
energy3Wat & array of $\mathbb{R}$, parameters & array of $\mathbb{R}$ & - \\
\hline
energy3PCM & array of $\mathbb{R}$, parameters & array of $\mathbb{R}$ & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

$eW1$: array of $\mathbb{R}$ \\
$eP1$: array of $\mathbb{R}$ \\
$eW2$: array of $\mathbb{R}$ \\
$eP2$: array of $\mathbb{R}$ \\
$eW3$: array of $\mathbb{R}$ \\
$eP3$: array of $\mathbb{R}$ 

\subsubsection{Assumptions}

All of the fields of the input parameters structure have been assigned a value. The values have been properly constrained.

\subsubsection{Access Routine Semantics}
\begin{center}
\begin{tabular}{l l p{6cm}}
energy1Wat($Tw1$, $params$): & transition: & ($\forall i \in [0..|Tw1| - 1]$) ($eW1[i] :=$ watEnergy($Tw1[i]$, $params$)) \\
& output: & $out := eW1$ \\ 
& exception: & none \\ \\
energy1PCM($Tp1$, $params$): & transition: & ($\forall i \in [0..|Tp1| - 1]$) ($eP1[i]:=$ pcmEnergy1($Tp1[i]$, $params$)) \\
& output: & $out := eP1$ \\ 
& exception: & none \\ \\
energy2Wat($Tw2$, $params$): & transition: & ($\forall i \in [0..|Tw2| - 1]$) ($eW2[i] :=$ watEnergy($Tw2[i]$, $params$)) \\
& output: & $out := eW2$ \\ 
& exception: & none \\ \\
energy2PCM($Qp2$, $params$): & transition: & ($\forall i \in [0..|Qp2| - 1]$) ($eP2[i] :=$ pcmEnergy2($Qp2[i]$, $params$)) \\
& output: & $out := eP2$ \\ 
& exception: & none \\ \\
energy3Wat($Tw3$, $params$): & transition: & ($\forall i \in [0..|Tw3| - 1]$) ($eW3[i] :=$ watEnergy($Tw3[i]$, $params$)) \\
& output: & $out := eW3$ \\ 
& exception: & none \\ \\
energy3PCM($Tp3$, $params$): & transition: & ($\forall i \in [0..|Tp3| - 1]$) ($eP3[i] :=$ pcmEnergy3($Tp3[i]$, $params$)) \\
& output: & $out := eP3$ \\
& exception: & none \\
\end{tabular}
\end{center}

\subsubsection{Local Functions}

watEnergy: $\mathbb{R}$ $\times$ parameters $\rightarrow$ $\mathbb{R}$ \\
watEnergy($Tw$, $params$) $\equiv$ $params.C\_w \times params.Mw \times (Tw - params.Tinit)$ \\
\newline
pcmEnergy1: $\mathbb{R}$ $\times$ parameters $\rightarrow$ $\mathbb{R}$ \\
pcmEnergy1($Tp$, $params$) $\equiv$ $params.C\_ps \times params.Mp \times (Tp - params.Tinit)$ \\
\newline
pcmEnergy2: $\mathbb{R}$ $\times$ parameters $\rightarrow$ $\mathbb{R}$ \\
pcmEnergy2($Qp$, $params$) $\equiv$ $params.Epmelt\_init + Qp$ \\
\newline
pcmEnergy3: $\mathbb{R}$ $\times$ parameters $\rightarrow$ $\mathbb{R}$ \\
pcmEnergy3($Tp$, $params$) $\equiv$ $params.Epmelt\_init + params.Ep\_melt3 + params.C\_pl \times params.Mp \times (Tp - params.Tmelt)$ \\

\newpage
\section{MIS of Output Verification Module} \label{VerifyOutput}

\subsection{Module}

verify\_output

\subsection{Uses}

Param (Section~\ref{Parameters})

\subsection{Syntax}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{3cm} p{7cm} p{2cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
verify\_output & array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, parameters & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

$expEPCM$: array of $\mathbb{R}$ \\
$expEWat$: array of $\mathbb{R}$ \\
$errorWater$: $\mathbb{R}$ \\
$errorPCM$: $\mathbb{R}$

\subsubsection{Environment Variables}

$win$: 2D array of pixels displayed on the screen

\subsubsection{Local Variables}

\subsubsection{Assumptions}

All of the fields of the input parameters structure have been assigned a
value. The values have been properly constrained. The input arrays are not
empty.

\subsubsection{Access Routine Semantics}

\begin{center}
\begin{tabular}{l l p{6cm}}
verify\_output($t$, $Tw$, $Tp$, $Ew$, $Ep$, $params$): & transition: & $expEPCM$, $expEWat$, $errorWater$, $errorPCM$, $win$ $:=$ ($\forall i \in [1..|t| - 1]$) (expectedEp(traprule(delta($t[i-1]$, $t[i]$), $Tw[i]$, $Tp[i]$, $Tw[i-1]$, $Tp[i-1]$), $params$)), ($\forall i \in [1..|t| - 1]$) (expectedEw (expectedEc(traprule(delta($t[i-1]$, $t[i]$), $params.Tc$, $Tw[i]$, $params.Tc$, $Tw[i-1]$), $params$), post($expEPCM$))), error(sum(post($expEWat$)), $Ew[|Ew| - 1]$), error(sum(post($expEPCM$)), $Ep[|Ep| - 1]$), ($errorWater > ConsTol \lor errorPCM > ConsTol \Rightarrow$ Prints warning message(s)) \\
& exception: & ($errorWater > ConsTol \Rightarrow$ warnWaterError $|$ $errorPCM > ConsTol \Rightarrow$ warnPCMError) These exceptions do not terminate the program.\\
\end{tabular}
\end{center}

\subsubsection{Local Functions}

delta: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
delta($t1$, $t2$) $\equiv$ $t2 - t1$ \\
\newline
traprule: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
traprule($t$, $A1$, $B1$, $A2$, $B2$) $\equiv$ $t \times (A1 - B1 + A2 - B2) / 2$ \\
\newline
expectedEc: $\mathbb{R}$ $\times$ parameters $\rightarrow$ $\mathbb{R}$ \\
expectedEc($c$, $params$) $\equiv$ $params.hc \times params.Ac \times c$ \\
\newline
expectedEp: $\mathbb{R}$ $\times$ parameters $\rightarrow$ $\mathbb{R}$ \\
expectedEp($p$, $params$) $\equiv$ $params.hp \times params.Ap \times p$ \\
\newline
expectedEw: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
expectedEw($Ec$, $Ep$) $\equiv$ $Ec - Ep$ \\
\newline
sum: array of $\mathbb{R}$s $\rightarrow$ $\mathbb{R}$ \\
sum($a$) $\equiv$ $\sum_{i=0}^{|a| - 1}$ $a[i]$ \\
\newline
error: $\mathbb{R}$ $\times$ $\mathbb{R}$ $\rightarrow$ $\mathbb{R}$ \\
error($exp$, $act$) $\equiv$ $\frac{|exp - act|}{act} \times 100$ \\

\newpage
\section{MIS of Plotting Module} \label{Plot}

\subsection{Module}

plot

\subsection{Uses}

N/A

\subsection{Syntax}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{8cm} p{2cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
plot & array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, string & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

$plotFilename$: string

\subsubsection{Environment Variables}

$directory$: The current directory of files from which the program is run.

\subsubsection{Assumptions}

The input arrays are all of the same size.

\subsubsection{Access Routine Semantics}

\begin{center}
\begin{tabular}{l l p{6cm}}
plot($t$, $Tw$, $Tp$, $Ew$, $Ep$, $filename$): & transition: & $directory$:
                                                               writes a .png
                                                               file named
                                                               $plotFilename$
                                                               containing the
                                                               graphs of the
                                                               simulation
                                                               results. \\
& exception: & none \\
\end{tabular}
\end{center}

\newpage
\section{MIS of Output Module} \label{Output}

\subsection{Module}

output

\subsection{Uses}

Param (Section~\ref{Parameters})

\subsection{Syntax}

\subsubsection{Exported Constants}

$max\_width$: integer

\subsubsection{Exported Access Program}

\begin{center}
\begin{tabular}{p{3cm} p{7cm} p{2cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
output & string, array of $\mathbb{R}$, array of $\mathbb{R}$, array of
         $\mathbb{R}$, array of $\mathbb{R}$, array of $\mathbb{R}$, array of
         $\mathbb{R}$, parameters & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

$outFilename$: string

\subsubsection{Environment Variables}

$directory$: The current directory of files from which the program is run.

\subsubsection{Access Routine Semantics}

\begin{center}
\begin{tabular}{l l p{4cm}}
output($params$, $t$, $Tw$, $Tp$, $Ew$, $Ep$, $ETot$, $filename$): & transition:
  & $directory$: writes a .txt file named $outFilename$ containing the input
    parameters, calculated parameters, and results of the simulation. \\

& exception: & none \\
\end{tabular}
\end{center}

\bibliographystyle {plainnat}
\bibliography {MIS}

\newpage
\section{Appendix} \label{Appendix}

\renewcommand{\arraystretch}{1.2}

\begin{longtable}{l p{12cm}}
\caption{Possible Exceptions} \\
\toprule
\textbf{Message ID} & \textbf{Error Message} \\
\midrule
badLength & Error: Tank length must be $> 0$ \\
badDiam & Error: Tank diameter must be $> 0$ \\
badPCMVolume & Error: PCM volume must be $> 0$ \\
badPCMAndTankVol & Error: PCM volume must be $<$ tank volume \\
badPCMArea & Error: PCM area must be $> 0$ \\
badPCMDensity & Error: rho\_p must be $> 0$ \\
badMeltTemp & Error: Tmelt must be $> 0$ and $< Tc$ \\
badCoilAndInitTemp & Error: Tc must be $>$ Tinit \\
badCoilTemp & Error: Tc must be $> 0$ and $< 100$ \\
badPCMHeatCapSolid & Error: C\_ps must be $> 0$ \\
badPCMHeatCapLiquid & Error: C\_pl must be $> 0$ \\
badHeatFusion & Error: Hf must be $> 0$ \\
badCoilArea & Error: Ac must be $> 0$ \\
badWaterDensity & Error: rho\_w must be $> 0$ \\
badWaterHeatCap & Error: C\_w must be $> 0$ \\
badCoilCoeff & Error: hc must be $> 0$ \\
badPCMCoeff & Error: hp must be $> 0$ \\
badInitTemp & Error: Tinit must be $> 0$ and $< 100$ \\
badFinalTime & Error: tfinal must be $> 0$ \\
badInitAndMeltTemp & Error: Tinit must be $<$ Tmelt \\
ODE\_ACCURACY & $reltol$ and $abstol$ were not satisfied by the ODE solver for a given solution step. \\
ODE\_BAD\_INPUT & Invalid input to ODE solver \\
ODE\_MAXSTEP & ODE solver took $MaxStep$ steps and did not find solution \\
warnLength & Warning: It is recommended that 0.1 $<$= L $<$= 50 \\
warnDiam & Warning: It is recommended that 0.002 $<$= D/L $<$= 200 \\
warnPCMVol & Warning: It is recommended that Vp be $>$= 0.0001\% of Vt \\
warnVolArea & Warning: It is recommended that Vp $<$= Ap $<$= (2/0.001) * Vp \\
warnPCMDensity & Warning: It is recommended that 500 $<$ rho\_p $<$ 20000 \\
warnPCMHeatCapSolid & Warning: It is recommended that 100 $<$ C\_ps $<$ 4000 \\
warnPCMHeatCapLiquid & Warning: It is recommended that 100 $<$ C\_pl $<$ 5000 \\
warnCoilArea & Warning: It is recommended that Ac $<$= pi * (D/2) $\wedge$ 2 \\
warnWaterDensity & Warning: It is recommended that 950 $<$ rho\_w $<$= 1000 \\
warnWaterHeatCap & Warning: It is recommended that 4170 $<$ C\_w $<$ 4210 \\
warnCoilCoeff & Warning: It is recommended that 10 $<$ hc $<$ 10000 \\
warnPCMCoeff & Warning: It is recommended that 10 $<$ hp $<$ 10000 \\
warnFinalTime & Warning: It is recommended that 0 $<$ tfinal $<$ 86400 \\
warnWaterError & Warning: There is greater than $x$\% relative error between the energy in the water output and the expected output based on the law of conservation of energy. (Where $x$ is the value of $ConsTol$) \\
warnPCMError & Warning: There is greater than $x$\% relative error between the energy in the PCM output and the expected output based on the law of conservation of energy. (Where $x$ is the value of $ConsTol$) \\
\bottomrule
\end{longtable}

\end{document}